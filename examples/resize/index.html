<!DOCTYPE html>
<html>
	<head>
		<title> Argure Demo: Image Resizing </title>
		<link href="../../public/stylesheets/ui.core.css" media="screen, projection" rel="stylesheet" type="text/css" /> 
		<link href="../../public/stylesheets/ui.form.css" media="screen, projection" rel="stylesheet" type="text/css" /> 
		<script src="../../spec/vendor/jquery-1.6.js"></script>
		<script src="../../spec/vendor/jquery.tmpl.js"></script>
		<script src="../../spec/vendor/knockout-1.2.1.debug.js"></script>
		<script src="../../public/javascripts/argure.js"></script>
	</head>
	<body>
		<div class='ui-widget container span-12'>
			<form id="resize" data-bind="submit: do_submit" class='ui-form'>
				<header id="header" class="info">
					<h3>Resize Image</h3>
				</header>
				<div class="field">
					<label for="initHeight" class="side">Initial Height</label>
					<span id="initHeight" data-bind="text: initHeight" class="constant"></span>
				</div>
				<div class="field">
					<label for="initWidth" class="side">Initial Width</label>
					<span id="initWidth" data-bind="text: initWidth" class="constant"></span>
				</div>
				<div data-bind="validate: absHeight" class="field">
					<label for="absHeight">Absolute Height</label>
					<input type="text" id="absHeight" data-bind="value: absHeight"/>
				</div>
				<div data-bind="validate: relHeight" class="field">
					<label for="relHeight">Relative Height</label>
					<input type="text" id="relHeight" data-bind="value: relHeight"/>
				</div>
				<div data-bind="validate: absWidth" class="field">
					<label for="absWidth">Absolute Width</label>
					<input type="text" id="absWidth" data-bind="value: absWidth"/>
				</div>
				<div data-bind="validate: relWidth" class="field">
					<label for="relWidth">Relative Width</label>
					<input type="text" id="relWidth" data-bind="value: relWidth"/>
				</div>
				<div class="field">
					<label for="ratio" class="side">Lock Ratio</label>
					<input type="checkbox" id="ratio" data-bind="checked: ratio"/>
				</div>
				<button type="submit">Resize</button>
			</form>
		</div>

		<script type="text/coffeescript" charset="utf-8">
			class Resizer extends Argure.Model
				constructor: (@initHeight, @initWidth) ->
					super()

				do_submit: ->
					if @errors.empty() then alert("Resized") else alert("Errors still present")
					false

				@observe 'absHeight'
				@observe 'relHeight', initial: 100
				@observe 'absWidth'
				@observe 'relWidth', initial: 100
				@observe 'ratio', initial: false
				
				@relate (c) ->
					c.method 'absHeight = (relHeight / 100.0) * initHeight'
					c.method 'relHeight = (absHeight / initHeight) * 100.0' 
				@relate (c) ->
					c.method 'absWidth = (relWidth / 100.0) * initWidth'
					c.method 'relWidth = (absWidth / initWidth) * 100.0' 
				@relate (c) ->
					c.when('ratio').method 'relHeight = relWidth'
					c.when('ratio').method 'relWidth = relHeight'
				
					#c.method 'relHeight = if ratio then relWidth else relHeight', undefined, (ratio) -> ratio
					#c.method 'relWidth  = if ratio then relHeight else relWidth', undefined, (ratio) -> ratio

				for n in ['relHeight', 'relWidth', 'absHeight', 'absWidth']
					@validatePresenceOf n
					@validateNumericalityOf n, minimum: 0
					

			this.resizer = new Resizer(1000, 1000)
			ko.applyBindings(this.resizer)
		</script>
							
	</body>
</html>
